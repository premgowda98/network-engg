## MITM Proxy with Docker

### Docker Setup 
1. Run MITM proxy using Docker Compose:
   ```bash
   docker-compose up -d
   ```
2. Configure Network Proxy on your host system pointing to the Docker container:
   - HTTP/HTTPS Proxy: `http://127.0.0.1:8080`
   - Use manual method instead of automatic in Ubuntu
3. Access the web interface at `http://127.0.0.1:8081` (password: mypassword)
4. Download certificates by visiting `http://mitm.it` through the proxy and follow instruction to install certs
5. Now enter this command `certutil -A -d sql:"$HOME/.pki/nssdb" -n "mitmproxy" -t "C,," -i /usr/local/share/ca-certificates/mitmproxy.crt` which will add the certificate to the chrome certificate store

### Understanding the Certificate
The certificate downloaded from `mitm.it` is a Certificate Authority (CA) certificate generated by mitmproxy. This certificate is crucial for intercepting HTTPS traffic because:

1. HTTPS traffic is encrypted using TLS/SSL
2. To decrypt and inspect this traffic, mitmproxy acts as a "man-in-the-middle"
3. It creates a CA certificate that your browser/system needs to trust
4. When you visit an HTTPS site through the proxy, mitmproxy dynamically generates a certificate for that site, signed by its CA
5. Without installing the CA certificate, your browser will show security warnings for every HTTPS site

### Handling Certificates with Docker
1. When using Docker, the certificates are generated inside the container.
2. To access the certificate files from the container:
   ```bash
   docker cp mitm_mitmproxy_1:/home/mitmproxy/.mitmproxy/mitmproxy-ca-cert.pem ./
   ```
   (The container name will be based on your directory name, typically something like "mitm-mitmproxy-1")
3. Install the certificate on your host system:
   - For Linux:
     ```bash
     sudo cp mitmproxy-ca-cert.pem /usr/local/share/ca-certificates/
     sudo update-ca-certificates
     ```
   - For macOS:
     Use the Keychain Access app to import the certificate and mark it as trusted.
   - For Windows:
     Use the Certificate Manager to import the certificate into the "Trusted Root Certification Authorities" store.

### Browser Setup
1. Most browsers use the system's certificate store, but some require additional setup:

   - **Chrome/Chromium**:
     - Go to Settings → Privacy and Security → Security → Manage certificates
     - Import the downloaded certificate into "Authorities" tab
     - Check "Trust this certificate for identifying websites"

   - **Firefox** (uses its own certificate store):
     - Go to Settings → Privacy & Security → Certificates → View Certificates
     - Import the downloaded certificate from mitm.it
     - Check "Trust this CA to identify websites"

   - **Safari**:
     - After adding to macOS keychain, go to Safari → Preferences → Privacy
     - Ensure certificates are being trusted

2. Verify certificate installation by visiting an HTTPS site through the proxy. If successful, you should see the traffic in the mitmweb interface without browser warnings.

### Intercepting HTTPS Traffic with Docker
1. Ensure that the mitmproxy CA certificate from the Docker container is installed and trusted on your host system and browser.
2. Configure your browser or application to use the proxy at `http://127.0.0.1:8080`.
3. Visit any HTTPS website, and mitmproxy will intercept the traffic.
4. View the intercepted traffic in the mitmweb interface at `http://127.0.0.1:8081`.

### Troubleshooting
1. If the proxy isn't working, verify the container is running with `docker ps`
2. Check the container name with `docker ps | grep mitmproxy`
3. Check the logs with `docker logs mitm-mitmproxy-1` (adjust container name as needed)
4. Ensure certificate is properly installed on your system
5. For mobile devices, you may need to manually install the certificate by downloading it from `http://mitm.it` when connected to the proxy
6. If you're still seeing certificate warnings, make sure you're accessing sites through the proxy